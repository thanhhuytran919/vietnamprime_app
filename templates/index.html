<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VIETNAMPRIME APP</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <h1>VIETNAMPRIME APP</h1>
    <div class="grid-container">
      <div class="grid-item">
        <a href="https://vi.wikipedia.org/wiki/Ca_tr%C3%B9" target="_blank">
          <img
            src="https://imagevietnam.vnanet.vn//MediaUpload/Org/2022/12/08/148-10-31-3.jpg"
            alt="Ca trù"
          />
        </a>
        <figcaption>Ca trù</figcaption>
      </div>
      <div class="grid-item">
        <a href="https://vi.wikipedia.org/wiki/Ch%C3%A8o" target="_blank">
          <img
            src="https://nld.mediacdn.vn/291774122806476800/2021/11/2/8-hinhbancong-thay-1635861315265132362888.jpg"
            alt="Chèo"
          />
        </a>
        <figcaption>Chèo</figcaption>
      </div>
      <div class="grid-item">
        <a
          href="https://vi.wikipedia.org/wiki/Ch%E1%BA%A7u_v%C4%83n"
          target="_blank"
        >
          <img
            src="https://vnn-imgs-f.vgcloud.vn/2021/04/18/22/dac-sac-lien-hoa-hat-van-chau-van-toan-quoc-2021.jpg"
            alt="Hát chầu văn"
          />
        </a>
        <figcaption>Hát chầu văn</figcaption>
      </div>
      <div class="grid-item">
        <a href="https://vi.wikipedia.org/wiki/H%C3%B2" target="_blank">
          <img
            src="https://cattour.vn/images/upload/images/Mien%20Tay/gioi-thieu-mien-tay/song-nuoc-2.png"
            alt="Hò"
          />
        </a>
        <figcaption>Hò</figcaption>
      </div>
      <div class="grid-item">
        <a
          href="https://vi.wikipedia.org/wiki/Nh%C3%A3_nh%E1%BA%A1c_cung_%C4%91%C3%ACnh_Hu%E1%BA%BF"
          target="_blank"
        >
          <img
            src="https://reviewvilla.vn/wp-content/uploads/2022/06/nha-nhac-cung-dinh-hue-3.jpg"
            alt="Nhạc cung đình"
          />
        </a>
        <figcaption>Nhạc cung đình</figcaption>
      </div>
      <div class="grid-item">
        <a
          href="https://vi.wikipedia.org/wiki/%C4%90%E1%BB%9Dn_ca_t%C3%A0i_t%E1%BB%AD_Nam_B%E1%BB%99"
          target="_blank"
        >
          <img
            src="https://lacvietaudio.com/wp-content/uploads/2022/11/Don-ca-tai-tu-tieng-anh-la-gi.jpg"
            alt="Nhạc tài tử"
          />
        </a>
        <figcaption>Nhạc tài tử</figcaption>
      </div>
      <div class="grid-item">
        <a href="https://vi.wikipedia.org/wiki/Quan_h%E1%BB%8D" target="_blank">
          <img
            src="https://wpd.com.vn/wp-content/uploads/2021/03/tai-sao-quan-ho-bac-ninh-lai-duoc-ghi-danh-la-di-san-van-hoa-noi-tieng-quan-ho-at-its-best.jpg"
            alt="Quan họ"
          />
        </a>
        <figcaption>Quan họ</figcaption>
      </div>
      <div class="grid-item">
        <a href="https://vi.wikipedia.org/wiki/X%E1%BA%A9m" target="_blank">
          <img
            src="https://cdnmedia.baotintuc.vn/Upload/0EyEGnQWcAZSg4tgdmWKkg/files/xam%20(3).jpg"
            alt="Xẩm"
          />
        </a>
        <figcaption>Xẩm</figcaption>
      </div>
    </div>

    <div class="container">
      <!-- Phần tải lên tệp âm thanh -->
      <form
        id="upload-form"
        action="/upload"
        method="POST"
        enctype="multipart/form-data"
      >
        <label for="audio-input" class="custom-file-upload">
          <input
            class="input"
            type="file"
            id="audio-input"
            name="audio"
            accept=".wav"
            onchange="validateAudioFile(this)"
          />
        </label>
        <button type="submit" class="classify-button">Dự đoán</button>
      </form>

      <!-- Phần hiển thị kết quả -->
      {% if category %}
      <div class="result">
        <div class="result-flex">
          <div class="result-item">
            <h3 class="youtube-header">Âm thanh kiểm tra:</h3>
            <audio controls class="audio-player">
              <source src="{{ audio_path }}" type="audio/wav" />
              Your browser does not support the audio element.
            </audio>
          </div>
          <div class="result-item">
            <h3 class="spectrogram-header">Ảnh Spectrogram:</h3>
            <div class="spectrogram-container">
              <img
                src="{{ segment_img_paths }}"
                alt="Best Spectrogram"
                class="best-spectrogram"
              />
            </div>
          </div>
        </div>
        <h2>Kết quả dự đoán</h2>
        <p class="category">
          Dòng nhạc được phân loại là: <strong>{{ category }} </strong>
        </p>
        <p class="confidence">
          Độ chính xác cao nhất:
          <strong>{{ highest_accuracy_common|round(2) }}% </strong>
        </p>
        <p class="confidence">
          Độ chính xác trung bình:
          <strong>{{ confidence_common|round(2) }}% </strong>
        </p>
        <p class="median-confidence">
          Độ chính xác trung vị:
          <strong>{{ median_confidence_common|round(2) }}% </strong>
        </p>
        <p class="description">
          Thông tin về dòng nhạc: {{ music_description }}
          <a href="{{ info_link }}" target="_blank">Xem thêm chi tiết</a>
        </p>
        <h3 class="youtube-header">Video liên quan</h3>
        <div class="youtube-video">
          {% for link in youtube_links %}
          <iframe
            width="360"
            height="200"
            src="{{ link.replace('watch?v=', 'embed/') }}"
            frameborder="0"
            allowfullscreen
          ></iframe>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
    <script>
      function validateAudioFile(input) {
        const maxDuration = 300; // 5 phút (5 * 60 giây)
        const file = input.files[0];

        if (file) {
          const objectURL = URL.createObjectURL(file);
          const audioElement = new Audio(objectURL);

          audioElement.addEventListener("loadedmetadata", function () {
            const duration = audioElement.duration;

            if (duration > maxDuration) {
              alert(
                "Tệp âm thanh quá dài. Vui lòng chọn tệp âm thanh dưới 5 phút."
              );
              input.value = ""; // Xóa tệp đã chọn
            }
          });
        }
      }
      document
        .getElementById("upload-form")
        .addEventListener("submit", function (event) {
          // Hiển thị phần spinner và thông báo "Đang xử lý" khi nhấn nút Phân loại
          document.getElementById("processing").style.display = "block";

          // Sau khi hiển thị phần kết quả, load lại trang
          location.reload();
        });

      // Sử dụng sự kiện "load" để cuộn xuống phần kết quả sau khi trang đã load lại
      window.addEventListener("load", function () {
        const resultSection = document.querySelector(".result");
        resultSection.scrollIntoView({ behavior: "smooth" });
      });
    </script>
  </body>

  <footer>
    <p class="author-text">Author: HuyBu</p>
  </footer>
</html>
